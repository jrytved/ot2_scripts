import json

from opentrons import protocol_api
from opentrons import types
from opentrons.types import Mount
from opentrons.protocols.api_support.util import build_edges

LABWARE_DEF_EPPENDORF_TWIN_TEC_96_JSON = """{"ordering":[["A1","B1","C1","D1","E1","F1","G1","H1"],["A2","B2","C2","D2","E2","F2","G2","H2"],["A3","B3","C3","D3","E3","F3","G3","H3"],["A4","B4","C4","D4","E4","F4","G4","H4"],["A5","B5","C5","D5","E5","F5","G5","H5"],["A6","B6","C6","D6","E6","F6","G6","H6"],["A7","B7","C7","D7","E7","F7","G7","H7"],["A8","B8","C8","D8","E8","F8","G8","H8"],["A9","B9","C9","D9","E9","F9","G9","H9"],["A10","B10","C10","D10","E10","F10","G10","H10"],["A11","B11","C11","D11","E11","F11","G11","H11"],["A12","B12","C12","D12","E12","F12","G12","H12"]],"brand":{"brand":"Eppendorftwin.tec","brandId":[]},"metadata":{"displayName":"EppendorfTwin.tec96WellPlate150µL","displayCategory":"wellPlate","displayVolumeUnits":"µL","tags":[]},"dimensions":{"xDimension":127.76,"yDimension":85.47,"zDimension":16.06},"wells":{"A1":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":14.38,"y":74.23,"z":1.46},"B1":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":14.38,"y":65.23,"z":1.46},"C1":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":14.38,"y":56.23,"z":1.46},"D1":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":14.38,"y":47.23,"z":1.46},"E1":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":14.38,"y":38.23,"z":1.46},"F1":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":14.38,"y":29.23,"z":1.46},"G1":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":14.38,"y":20.23,"z":1.46},"H1":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":14.38,"y":11.23,"z":1.46},"A2":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":23.38,"y":74.23,"z":1.46},"B2":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":23.38,"y":65.23,"z":1.46},"C2":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":23.38,"y":56.23,"z":1.46},"D2":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":23.38,"y":47.23,"z":1.46},"E2":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":23.38,"y":38.23,"z":1.46},"F2":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":23.38,"y":29.23,"z":1.46},"G2":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":23.38,"y":20.23,"z":1.46},"H2":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":23.38,"y":11.23,"z":1.46},"A3":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":32.38,"y":74.23,"z":1.46},"B3":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":32.38,"y":65.23,"z":1.46},"C3":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":32.38,"y":56.23,"z":1.46},"D3":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":32.38,"y":47.23,"z":1.46},"E3":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":32.38,"y":38.23,"z":1.46},"F3":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":32.38,"y":29.23,"z":1.46},"G3":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":32.38,"y":20.23,"z":1.46},"H3":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":32.38,"y":11.23,"z":1.46},"A4":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":41.38,"y":74.23,"z":1.46},"B4":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":41.38,"y":65.23,"z":1.46},"C4":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":41.38,"y":56.23,"z":1.46},"D4":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":41.38,"y":47.23,"z":1.46},"E4":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":41.38,"y":38.23,"z":1.46},"F4":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":41.38,"y":29.23,"z":1.46},"G4":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":41.38,"y":20.23,"z":1.46},"H4":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":41.38,"y":11.23,"z":1.46},"A5":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":50.38,"y":74.23,"z":1.46},"B5":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":50.38,"y":65.23,"z":1.46},"C5":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":50.38,"y":56.23,"z":1.46},"D5":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":50.38,"y":47.23,"z":1.46},"E5":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":50.38,"y":38.23,"z":1.46},"F5":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":50.38,"y":29.23,"z":1.46},"G5":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":50.38,"y":20.23,"z":1.46},"H5":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":50.38,"y":11.23,"z":1.46},"A6":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":59.38,"y":74.23,"z":1.46},"B6":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":59.38,"y":65.23,"z":1.46},"C6":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":59.38,"y":56.23,"z":1.46},"D6":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":59.38,"y":47.23,"z":1.46},"E6":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":59.38,"y":38.23,"z":1.46},"F6":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":59.38,"y":29.23,"z":1.46},"G6":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":59.38,"y":20.23,"z":1.46},"H6":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":59.38,"y":11.23,"z":1.46},"A7":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":68.38,"y":74.23,"z":1.46},"B7":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":68.38,"y":65.23,"z":1.46},"C7":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":68.38,"y":56.23,"z":1.46},"D7":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":68.38,"y":47.23,"z":1.46},"E7":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":68.38,"y":38.23,"z":1.46},"F7":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":68.38,"y":29.23,"z":1.46},"G7":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":68.38,"y":20.23,"z":1.46},"H7":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":68.38,"y":11.23,"z":1.46},"A8":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":77.38,"y":74.23,"z":1.46},"B8":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":77.38,"y":65.23,"z":1.46},"C8":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":77.38,"y":56.23,"z":1.46},"D8":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":77.38,"y":47.23,"z":1.46},"E8":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":77.38,"y":38.23,"z":1.46},"F8":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":77.38,"y":29.23,"z":1.46},"G8":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":77.38,"y":20.23,"z":1.46},"H8":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":77.38,"y":11.23,"z":1.46},"A9":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":86.38,"y":74.23,"z":1.46},"B9":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":86.38,"y":65.23,"z":1.46},"C9":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":86.38,"y":56.23,"z":1.46},"D9":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":86.38,"y":47.23,"z":1.46},"E9":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":86.38,"y":38.23,"z":1.46},"F9":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":86.38,"y":29.23,"z":1.46},"G9":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":86.38,"y":20.23,"z":1.46},"H9":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":86.38,"y":11.23,"z":1.46},"A10":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":95.38,"y":74.23,"z":1.46},"B10":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":95.38,"y":65.23,"z":1.46},"C10":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":95.38,"y":56.23,"z":1.46},"D10":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":95.38,"y":47.23,"z":1.46},"E10":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":95.38,"y":38.23,"z":1.46},"F10":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":95.38,"y":29.23,"z":1.46},"G10":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":95.38,"y":20.23,"z":1.46},"H10":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":95.38,"y":11.23,"z":1.46},"A11":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":104.38,"y":74.23,"z":1.46},"B11":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":104.38,"y":65.23,"z":1.46},"C11":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":104.38,"y":56.23,"z":1.46},"D11":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":104.38,"y":47.23,"z":1.46},"E11":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":104.38,"y":38.23,"z":1.46},"F11":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":104.38,"y":29.23,"z":1.46},"G11":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":104.38,"y":20.23,"z":1.46},"H11":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":104.38,"y":11.23,"z":1.46},"A12":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":113.38,"y":74.23,"z":1.46},"B12":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":113.38,"y":65.23,"z":1.46},"C12":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":113.38,"y":56.23,"z":1.46},"D12":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":113.38,"y":47.23,"z":1.46},"E12":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":113.38,"y":38.23,"z":1.46},"F12":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":113.38,"y":29.23,"z":1.46},"G12":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":113.38,"y":20.23,"z":1.46},"H12":{"depth":14.6,"totalLiquidVolume":150,"shape":"circular","diameter":6.46,"x":113.38,"y":11.23,"z":1.46}},"groups":[{"metadata":{"wellBottomShape":"v"},"wells":["A1","B1","C1","D1","E1","F1","G1","H1","A2","B2","C2","D2","E2","F2","G2","H2","A3","B3","C3","D3","E3","F3","G3","H3","A4","B4","C4","D4","E4","F4","G4","H4","A5","B5","C5","D5","E5","F5","G5","H5","A6","B6","C6","D6","E6","F6","G6","H6","A7","B7","C7","D7","E7","F7","G7","H7","A8","B8","C8","D8","E8","F8","G8","H8","A9","B9","C9","D9","E9","F9","G9","H9","A10","B10","C10","D10","E10","F10","G10","H10","A11","B11","C11","D11","E11","F11","G11","H11","A12","B12","C12","D12","E12","F12","G12","H12"]}],"parameters":{"format":"irregular","quirks":[],"isTiprack":false,"isMagneticModuleCompatible":true,"loadName":"eppendorftwin.tec_96_wellplate_150ul"},"namespace":"custom_beta","version":2,"schemaVersion":2,"cornerOffsetFromSlot":{"x":0,"y":0,"z":0}}"""
LABWARE_DEF_EPPENDORF_TWIN_TEC_96 = json.loads(LABWARE_DEF_EPPENDORF_TWIN_TEC_96_JSON)

LABWARE_DEF_EVOTIPS_JSON = """{"ordering":[["A1","B1","C1","D1","E1","F1","G1","H1"],["A2","B2","C2","D2","E2","F2","G2","H2"],["A3","B3","C3","D3","E3","F3","G3","H3"],["A4","B4","C4","D4","E4","F4","G4","H4"],["A5","B5","C5","D5","E5","F5","G5","H5"],["A6","B6","C6","D6","E6","F6","G6","H6"],["A7","B7","C7","D7","E7","F7","G7","H7"],["A8","B8","C8","D8","E8","F8","G8","H8"],["A9","B9","C9","D9","E9","F9","G9","H9"],["A10","B10","C10","D10","E10","F10","G10","H10"],["A11","B11","C11","D11","E11","F11","G11","H11"],["A12","B12","C12","D12","E12","F12","G12","H12"]],"brand":{"brand":"Evosep","brandId":["EvotipEV-2001"]},"metadata":{"displayName":"Evosep96TipRack200µL","displayCategory":"tipRack","displayVolumeUnits":"µL","tags":[]},"dimensions":{"xDimension":127.5,"yDimension":85.7,"zDimension":82},"wells":{"A1":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":13.5,"y":74.7,"z":52},"B1":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":13.5,"y":65.7,"z":52},"C1":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":13.5,"y":56.7,"z":52},"D1":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":13.5,"y":47.7,"z":52},"E1":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":13.5,"y":38.7,"z":52},"F1":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":13.5,"y":29.7,"z":52},"G1":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":13.5,"y":20.7,"z":52},"H1":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":13.5,"y":11.7,"z":52},"A2":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":22.5,"y":74.7,"z":52},"B2":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":22.5,"y":65.7,"z":52},"C2":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":22.5,"y":56.7,"z":52},"D2":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":22.5,"y":47.7,"z":52},"E2":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":22.5,"y":38.7,"z":52},"F2":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":22.5,"y":29.7,"z":52},"G2":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":22.5,"y":20.7,"z":52},"H2":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":22.5,"y":11.7,"z":52},"A3":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":31.5,"y":74.7,"z":52},"B3":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":31.5,"y":65.7,"z":52},"C3":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":31.5,"y":56.7,"z":52},"D3":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":31.5,"y":47.7,"z":52},"E3":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":31.5,"y":38.7,"z":52},"F3":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":31.5,"y":29.7,"z":52},"G3":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":31.5,"y":20.7,"z":52},"H3":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":31.5,"y":11.7,"z":52},"A4":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":40.5,"y":74.7,"z":52},"B4":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":40.5,"y":65.7,"z":52},"C4":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":40.5,"y":56.7,"z":52},"D4":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":40.5,"y":47.7,"z":52},"E4":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":40.5,"y":38.7,"z":52},"F4":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":40.5,"y":29.7,"z":52},"G4":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":40.5,"y":20.7,"z":52},"H4":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":40.5,"y":11.7,"z":52},"A5":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":49.5,"y":74.7,"z":52},"B5":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":49.5,"y":65.7,"z":52},"C5":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":49.5,"y":56.7,"z":52},"D5":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":49.5,"y":47.7,"z":52},"E5":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":49.5,"y":38.7,"z":52},"F5":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":49.5,"y":29.7,"z":52},"G5":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":49.5,"y":20.7,"z":52},"H5":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":49.5,"y":11.7,"z":52},"A6":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":58.5,"y":74.7,"z":52},"B6":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":58.5,"y":65.7,"z":52},"C6":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":58.5,"y":56.7,"z":52},"D6":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":58.5,"y":47.7,"z":52},"E6":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":58.5,"y":38.7,"z":52},"F6":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":58.5,"y":29.7,"z":52},"G6":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":58.5,"y":20.7,"z":52},"H6":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":58.5,"y":11.7,"z":52},"A7":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":67.5,"y":74.7,"z":52},"B7":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":67.5,"y":65.7,"z":52},"C7":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":67.5,"y":56.7,"z":52},"D7":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":67.5,"y":47.7,"z":52},"E7":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":67.5,"y":38.7,"z":52},"F7":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":67.5,"y":29.7,"z":52},"G7":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":67.5,"y":20.7,"z":52},"H7":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":67.5,"y":11.7,"z":52},"A8":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":76.5,"y":74.7,"z":52},"B8":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":76.5,"y":65.7,"z":52},"C8":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":76.5,"y":56.7,"z":52},"D8":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":76.5,"y":47.7,"z":52},"E8":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":76.5,"y":38.7,"z":52},"F8":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":76.5,"y":29.7,"z":52},"G8":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":76.5,"y":20.7,"z":52},"H8":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":76.5,"y":11.7,"z":52},"A9":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":85.5,"y":74.7,"z":52},"B9":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":85.5,"y":65.7,"z":52},"C9":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":85.5,"y":56.7,"z":52},"D9":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":85.5,"y":47.7,"z":52},"E9":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":85.5,"y":38.7,"z":52},"F9":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":85.5,"y":29.7,"z":52},"G9":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":85.5,"y":20.7,"z":52},"H9":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":85.5,"y":11.7,"z":52},"A10":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":94.5,"y":74.7,"z":52},"B10":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":94.5,"y":65.7,"z":52},"C10":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":94.5,"y":56.7,"z":52},"D10":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":94.5,"y":47.7,"z":52},"E10":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":94.5,"y":38.7,"z":52},"F10":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":94.5,"y":29.7,"z":52},"G10":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":94.5,"y":20.7,"z":52},"H10":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":94.5,"y":11.7,"z":52},"A11":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":103.5,"y":74.7,"z":52},"B11":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":103.5,"y":65.7,"z":52},"C11":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":103.5,"y":56.7,"z":52},"D11":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":103.5,"y":47.7,"z":52},"E11":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":103.5,"y":38.7,"z":52},"F11":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":103.5,"y":29.7,"z":52},"G11":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":103.5,"y":20.7,"z":52},"H11":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":103.5,"y":11.7,"z":52},"A12":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":112.5,"y":74.7,"z":52},"B12":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":112.5,"y":65.7,"z":52},"C12":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":112.5,"y":56.7,"z":52},"D12":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":112.5,"y":47.7,"z":52},"E12":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":112.5,"y":38.7,"z":52},"F12":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":112.5,"y":29.7,"z":52},"G12":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":112.5,"y":20.7,"z":52},"H12":{"depth":30,"totalLiquidVolume":200,"shape":"circular","diameter":5,"x":112.5,"y":11.7,"z":52}},"groups":[{"metadata":{"wellBottomShape":"v"},"wells":["A1","B1","C1","D1","E1","F1","G1","H1","A2","B2","C2","D2","E2","F2","G2","H2","A3","B3","C3","D3","E3","F3","G3","H3","A4","B4","C4","D4","E4","F4","G4","H4","A5","B5","C5","D5","E5","F5","G5","H5","A6","B6","C6","D6","E6","F6","G6","H6","A7","B7","C7","D7","E7","F7","G7","H7","A8","B8","C8","D8","E8","F8","G8","H8","A9","B9","C9","D9","E9","F9","G9","H9","A10","B10","C10","D10","E10","F10","G10","H10","A11","B11","C11","D11","E11","F11","G11","H11","A12","B12","C12","D12","E12","F12","G12","H12"]}],"parameters":{"format":"irregular","quirks":[],"isTiprack":true,"tipLength":50,"isMagneticModuleCompatible":false,"loadName":"evosep_96_evotips"},"namespace":"custom_beta","version":2,"schemaVersion":2,"cornerOffsetFromSlot":{"x":0,"y":0,"z":0}}"""

LABWARE_DEF_EVOTIPS = json.loads(LABWARE_DEF_EVOTIPS_JSON)
LABWARE_DEF_COLUMN_COUNT = 12

class OpentronsTiploader:
    def __init__(self, protocol: protocol_api.ProtocolContext, p300IsMountedLeft: bool):
        self.protocol = protocol
        # Pipettes (multi=8-channel)
        self.p300M = protocol.load_instrument('p300_multi_gen2', p300IsMountedLeft and Mount.LEFT or Mount.RIGHT)
        self.p20M = protocol.load_instrument('p20_multi_gen2', p300IsMountedLeft and Mount.RIGHT or Mount.LEFT)

    def load_labware(self, evotip_column_from: int, evotip_column_count: int, p20_column_start: int, p20_column_increment: bool):
        # Custom labware for samples and Evotips
        sample_rack_start = (evotip_column_from-1)//LABWARE_DEF_COLUMN_COUNT
        sample_rack_end = (evotip_column_from+evotip_column_count-2)//LABWARE_DEF_COLUMN_COUNT
        self.samples = [None, None, None]
        self.evotips = [None, None, None]
        for rack in range(sample_rack_start, sample_rack_end+1):
            self.samples[rack] = self.protocol.load_labware_from_definition(LABWARE_DEF_EPPENDORF_TWIN_TEC_96, rack+1)
            self.evotips[rack] = self.protocol.load_labware_from_definition(LABWARE_DEF_EVOTIPS, rack+4)
        # Sample handling tips
        sample_handling_rack_start = (p20_column_start-1)//LABWARE_DEF_COLUMN_COUNT
        sample_handling_rack_end = p20_column_increment and ((p20_column_start+evotip_column_count-2)//LABWARE_DEF_COLUMN_COUNT) or sample_handling_rack_start
        self.tiprack_20ul = [None, None, None]
        for rack in range(sample_handling_rack_start, sample_handling_rack_end+1):
            self.tiprack_20ul[rack] = self.protocol.load_labware('opentrons_96_tiprack_20ul', rack+7)
        # Liquid handling tips
        self.tiprack_300ul = self.protocol.load_labware('opentrons_96_tiprack_300ul', 10)
        # Solvent plate for buffer A and isopropanol
        self.solvent_reservoir = self.protocol.load_labware('usascientific_12_reservoir_22ml', 11)

    def load_column(self, evotip_column_number: int, sample_column_number: int, p20_column_number: int, p200_column_number: int, dispose_sample_handling_tips: bool, dispose_solvent_handling_tips: bool):
        evotip_column = self.evotips[(evotip_column_number-1)//LABWARE_DEF_COLUMN_COUNT].rows()[0][(evotip_column_number-1)%LABWARE_DEF_COLUMN_COUNT]
        sample_column = self.samples[(sample_column_number-1)//LABWARE_DEF_COLUMN_COUNT].rows()[0][(sample_column_number-1)%LABWARE_DEF_COLUMN_COUNT]
        tiprack_20ul_column = self.tiprack_20ul[(p20_column_number-1)//LABWARE_DEF_COLUMN_COUNT].rows()[0][(p20_column_number-1)%LABWARE_DEF_COLUMN_COUNT]
        tiprack_300ul_column = self.tiprack_300ul.rows()[0][p200_column_number-1]
        buffer_a = self.solvent_reservoir.rows()[0][(evotip_column_number-1)//LABWARE_DEF_COLUMN_COUNT]
        isoprop = self.solvent_reservoir.rows()[0][11]

        # Put solvent A in Evotips (all the way down)
        self.protocol.comment("Step 1: Solvent A in Evotips")
        self.p300M.pick_up_tip(tiprack_300ul_column)
        self.p300M.aspirate(10, buffer_a.top(10))
        self.p300M.aspirate(15, buffer_a.bottom(8))
        self.p300M.aspirate(5, buffer_a.top(0))
        self.p300M.move_to(evotip_column.top(30))
        self.p300M.dispense(30, evotip_column.bottom(-3.5), rate=3)
        self.p300M.move_to(evotip_column.bottom(0), speed=3)
        self.p300M.move_to(evotip_column.top(20))
        self.p300M.move_to(evotip_column.top(5))
        self.p300M.move_to(evotip_column.top(30))
        self.p300M.touch_tip(v_offset=-5, radius=0.15)
        self.p300M.return_tip()
        # Soak Evotips
        self.protocol.comment("Step 2: Soak Evotips")
        self.p300M.move_to(evotip_column.top(30))
        self.p300M.pick_up_tip(evotip_column)
        self.p300M.move_to(isoprop.bottom(4), speed=80)
        self.p300M.aspirate(50)
        self.protocol.delay(seconds=10)
        self.p300M.dispense(30)
        # Tips back to Evotip rack
        self.p300M.move_to(evotip_column.top(30))
        self.p300M.drop_tip(evotip_column.bottom(-10))
        # Get sample material
        self.protocol.comment("Step 3: Sample in Evotips")
        self.p20M.pick_up_tip(tiprack_20ul_column)
        self.p20M.aspirate(20, sample_column.bottom(1), rate=0.8)
        # Put sample into Evotips
        self.p20M.move_to(evotip_column.top(30))
        self.p20M.dispense(20, evotip_column.bottom(-4.5), rate=0.2)
        self.p20M.move_to(evotip_column.bottom(5), speed=4)
        self.p20M.move_to(evotip_column.top(20))
        self.p20M.move_to(evotip_column.top(5))
        self.p20M.move_to(evotip_column.top(30))
        self.p20M.touch_tip(v_offset=-5, radius=0.15)
        if dispose_sample_handling_tips:
            self.p20M.drop_tip()
        else:
            self.p20M.return_tip(home_after=False)
        # Dispense A
        self.protocol.comment("Step 4: Solvent A in Evotips")
        self.p300M.pick_up_tip(tiprack_300ul_column)
        self.p300M.move_to(buffer_a.top(0))
        self.p300M.aspirate(150, buffer_a.bottom(4))
        self.p300M.move_to(evotip_column.top(30))
        self.p300M.dispense(50, evotip_column.bottom(5), rate=0.1)
        self.p300M.move_to(evotip_column.bottom(7), speed=50)
        self.p300M.dispense(50, evotip_column.bottom(7), rate=0.1)
        self.p300M.move_to(evotip_column.bottom(9), speed=50)
        self.p300M.dispense(50, evotip_column.bottom(9), rate=0.1)
        self.p300M.move_to(evotip_column.top(0))
        self.p300M.move_to(evotip_column.top(20))
        self.p300M.move_to(evotip_column.top(5))
        self.p300M.move_to(evotip_column.top(30))
        self.p300M.touch_tip(v_offset=-5, radius=0.15)
        if dispose_solvent_handling_tips:
            self.p300M.drop_tip()
        else:
            self.p300M.return_tip()
        # Push
        self.protocol.comment("Step 5: Push sample through")
        hardware_api = self.protocol._hw_manager.hardware # May not work in a future version of the API!
        p300Mount = self.p300M.mount.lower() == 'left' and Mount.LEFT or Mount.RIGHT
        hardware_api.add_tip(mount=p300Mount, tip_length=50)
        self.p300M.move_to(evotip_column.top(30))
        self.p300M.move_to(evotip_column.bottom(-10))
        hardware_api.prepare_for_aspirate(mount=p300Mount)
        hardware_api.aspirate(mount=p300Mount, volume=300, rate=10)
        self.p300M.move_to(evotip_column.bottom(-34.5), speed=20)
        hardware_api.dispense(mount=p300Mount, volume=300, rate=100)
        self.protocol.delay(seconds=100)
        self.p300M.move_to(evotip_column.bottom(-25), speed=20)
        edges = build_edges(where=evotip_column, offset=-53, mount=p300Mount, deck=self.protocol.deck, radius=0.10)
        for edge in edges:
           hardware_api.move_to(mount=p300Mount, abs_position=edge)
        self.p300M.move_to(evotip_column.bottom(-22.5).move(types.Point(x=0.85, y=0, z=0)))
        hardware_api.drop_tip(mount=p300Mount, home_after=False)
        # Move to rest position
        self.p300M.move_to(self.protocol.deck[12].well(0).top(60))
        self.protocol.home()

    def load_columns(self, evotip_column_from: int, evotip_column_count: int, p20_column_start: int, p20_column_increment: bool, p200_column_number: int, dispose_tips_when_done: bool):
        self.load_labware(evotip_column_from, evotip_column_count, p20_column_start, p20_column_increment)
        last_column = evotip_column_from + evotip_column_count - 1
        for column_number in range(evotip_column_from, evotip_column_from + evotip_column_count):
            dispose_sample_handling_tips = dispose_tips_when_done and (p20_column_increment or column_number == last_column)
            dispose_solvent_handling_tips = dispose_tips_when_done and column_number == last_column
            self.load_column(column_number, column_number, p20_column_start, p200_column_number, dispose_sample_handling_tips, dispose_solvent_handling_tips)
            if p20_column_increment:
                p20_column_start += 1

metadata = {
        'apiLevel': '2.9',
        'protocolName': 'OT-2 Evotip Loading Protocol, v1.3 (8 tips, 2026-01-20 14:05:09)',
        'description': '''Loads 1 column with sample starting from deck 1, column 1 and sample handling tips from deck 7, column 1. Solvent A handling with tips from deck 10, column 1.''',
        'author': 'Evosep Biosystems'
    }

def run(protocol: protocol_api.ProtocolContext):
    OpentronsTiploader(protocol, True).load_columns(1, 1, 1, 1, 1, 1)

# Generated on 2026-01-20 14:05:09